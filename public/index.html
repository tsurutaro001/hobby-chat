<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hobby Chat</title>
<style>
body{font-family:system-ui;margin:0;display:flex;flex-direction:column;height:100vh}
#log{flex:1;overflow:auto;padding:12px;background:#fafafa}
#bar{display:flex;gap:8px;padding:8px;border-top:1px solid #e5e5e5;background:#fff}
input,button{font-size:16px}
.bubble{margin:6px 0;padding:8px 10px;border-radius:8px;background:#f1f3f5;max-width:80%}
.sys{color:#666;font-size:12px;margin:8px 0}
.me{background:#e8f0ff;margin-left:auto}
header{display:flex;align-items:center;gap:8px;padding:10px 12px;border-bottom:1px solid #e5e5e5;background:#fff;position:sticky;top:0}
header h1{font-size:16px;margin:0}
.chip{font-size:12px;padding:2px 8px;border:1px solid #ddd;border-radius:999px}
</style>
<header><h1>Hobby Chat</h1><span class="chip">MVP</span></header>
<div id="log"></div>
<div id="bar">
  <input id="name" placeholder="ニックネーム" style="width:30%">
  <input id="text" placeholder="メッセージを入力" style="flex:1">
  <button id="send">送信</button>
</div>
<script src="/socket.io/socket.io.js" crossorigin="anonymous"></script>
<script>
const socket = io();
const log = document.getElementById('log');
const nameI = document.getElementById('name');
const textI = document.getElementById('text');
const sendB = document.getElementById('send');

function addSys(t){
  const p = document.createElement('div');
  p.className = 'sys';
  p.textContent = t;
  log.append(p);
  log.scrollTop = log.scrollHeight;
}
function addMsg(n, t, me=false){
  const d = document.createElement('div');
  d.className = 'bubble' + (me ? ' me' : '');
  d.textContent = `${n}: ${t}`;
  log.append(d);
  log.scrollTop = log.scrollHeight;
}
socket.on('sys', addSys);
socket.on('msg', ({name, text}) => addMsg(name, text, name === nameI.value.trim()));
function joinIfNeeded(){
  const n = nameI.value.trim();
  if(n) socket.emit('join', n);
}
sendB.onclick = () => {
  joinIfNeeded();
  const t = textI.value.trim();
  if(!t) return;
  socket.emit('msg', t);
  textI.value = '';
};
textI.addEventListener('keydown', e => { if(e.key === 'Enter') sendB.click(); });
</script>
</html>
